#!/usr/bin/env bash

set -e 

LINE=($(cat /var/log/pacman.log | grep "Running 'pacman -Syu" | tail --lines=1))
LINE=${LINE:1:24}
TIME_LAST_RUN=$(date -d "$LINE" +%s)
TIME_NOW=$(date -d "now" +%s)
TIME_ELAPSED=$((TIME_NOW-TIME_LAST_RUN))
DAY_IN_SECONDS=$((60*60*24))
TIME_TRESHOLD=$((DAY_IN_SECONDS * 7))
 
# Only ask to run pacman -Syu if it's been over 7 days since the last time we ran it
if [ $(($TIME_ELAPSED < $TIME_TRESHOLD )) == 1 ]; then
    exit 0
fi;

# Ask for confirmation before running
read -p "It's been 7 days days since you last ran \`pacman -Syu\`. Do you wish to run it now? [Y/n]" CONFIRM
if [ "$CONFIRM" == "n"  ] || [ "$CONFIRM" == "N" ]; then
	exit 0;
fi;

sudo pacman -Syu