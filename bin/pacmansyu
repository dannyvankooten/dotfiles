#!/bin/bash

LINE=($(cat /var/log/pacman.log | grep "Running 'pacman -Syu" | tail --lines=1))
LINE=${LINE:1:24}
TIME_LAST_RUN=$(date -d "$LINE" +%s)
TIME_NOW=$(date -d "now" +%s)
TIME_ELAPSED=$((TIME_NOW-TIME_LAST_RUN))
DAY_IN_SECONDS=$((60*60*24))
DAYS_ELAPSED=$((TIME_ELASPED / DAY_IN_SECONDS))
 
if [ $((DAYS_ELAPSED < DAY_IN_SECONDS * 7 )) == 1 ]; then
    exit 0
fi;

read -p "It's been $DAYS_ELAPSED days since you last ran \`pacman -Syu\`. Do you wish to run it now? [Y/n]" CONFIRM
if [ "$CONFIRM" == "n"  ] || [ "$CONFIRM" == "N" ]; then
	exit 0;
fi;

sudo pacman -Syu